<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ModelVault Viewer</title>
  <style>
    body { font-family: sans-serif; }
    ul { list-style: none; padding: 0; }
    li { padding: 5px; cursor: pointer; }
    li.folder { font-weight: bold; color: darkgreen; }
    li.file { color: blue; }
    #backBtn { margin-bottom: 10px; display:none; }
  </style>
</head>
<body>
  <h1>Dropbox ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h1>
  <button id="backBtn">æˆ»ã‚‹</button>
  <ul id="file-list"></ul>
  <video id="videoPlayer" width="640" height="360" controls style="display:none; margin-top:1em;"></video>

  <script>
    const ACCESS_TOKEN = "sl.u.AGC5jnmDzU8Fi7MEWpaT8MzBIawTj8HkNOzfAZ9ZCunFH9cWZp16B0KEmO5otZviX7nY4AyzymWpnKmsaZd6gvmNQ7MHm4a4jXrKWgZKnQXNp6xHPgV98DyldB-RgjYqqDQhuNS3L1kvGeyUIUQQPuwPQ95lnBUn4sxRK9mqf4onMN3cCftrv5Vvw33Xkk6lmTD8OXbUCBAaH2pmCVZ6gn5nQ4Ta3-B5rvtuyFXSaOScCJeg6spkslOdOgmv9w2m30QyqywE_e5Lw0dV6XLUBQI_MRMMEFgC1D4C7M_lbBTiOsWQtOFy9eBAidc2iq4D750YhbS4_Crk6JlzaqcGY_0GHU9Emdppb-aT9tigrrBXOm9aag6PiTGKkzyKrCIs_5iVsSrzNDfsMIrlYLIwoTsnsSmXyujQbVbPTrckMwcjCbU-f_57ey5fN1HG0AXSY3zXidH8HG4aP2P9VbCQAmSy5K8FHVN_ezgXe2hLK3beRHOHM4zYk7jg6PtSQVSoG9i6wpfWMONHYKMn0d98J86jr3dRtPz4VCj_JoKPh-lI3PH3kqPUybCI28_bux3Kqm9dlnzBVoL0nACn4YWHE5eA-PuOtLkaqaUbrW5xIQHJYk24VGLJ326JZKVGy9n47s5zc5DhTUt-9o4fPdTbsiG8gtZceH102vN1UQBbqcxGrBnnk24i50seQ0N3fIMUcmH69F-7ywVkdNP1_oROmou_RQpZYLVqXj8xn19E-3qiERR4QDfihVfeysI4UX83Yz_W4KoGCnW3BYftbGhzCwmNtvKlV5mdUSABdI8juX25bE4QVVkPuYDDizy58xVMbQ6bLS0gXZbvbxg3PSYeoS2xWLJngVyaPvd9PDl6cUpo-sDGvIAPvFQFInBvqJ4_Kx8WuCtqLA4XuBZEinC6lIcxe8nKr08fBuNtB0hMO0f85rZLJemubjKmr5MDufTUIvtIc3XAfLPy4Fpvro54aJa_eCiWWtl4xmHWPkH7HJ6ak4DHntxTly2NyiouVN6_bJKHr61tSqDY8VAmfO82zzZovf1rtfhLudQVM9PWX-riDFZbQDj0m6vUftLuoZktqPbuouCFc-hTqLvBRvbIGgbLSOCpqDPZPq99e85YawQPYK9p7H1KeOAmKYS7goACrnRBdB7cMKXOBWLKcEEmyo4sRTO5sM5cd9tKKaimYpwyFZTBiUSblwFkq5FD3DCKrnb4WKy2q9hIE5UTDaj9DIqxYDcx1DCVnoCP-ZiNbSUUB9z1F0SxkK6ax8xobeiKObU"; 
    const LIST_API = "https://api.dropboxapi.com/2/files/list_folder";
    const TEMP_LINK_API = "https://api.dropboxapi.com/2/files/get_temporary_link";

    // ğŸ“‚ ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’ç®¡ç†ï¼ˆæˆ»ã‚‹æ©Ÿèƒ½ç”¨ï¼‰
    let pathHistory = [];

    async function fetchFiles(path = "") {
      // âœ… ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã„ãŸã‚‰å‹•ç”»ã‚’æ­¢ã‚ã‚‹
      const videoPlayer = document.getElementById("videoPlayer");
      videoPlayer.pause();
      videoPlayer.src = "";
      videoPlayer.style.display = "none";

      const response = await fetch(LIST_API, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + ACCESS_TOKEN,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ path })
      });
      const data = await response.json();

      const list = document.getElementById("file-list");
      list.innerHTML = ""; // å‰å›ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

      // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
      const backBtn = document.getElementById("backBtn");
      backBtn.style.display = pathHistory.length > 0 ? "inline-block" : "none";

      data.entries.forEach(entry => {
        const li = document.createElement("li");
        li.textContent = entry.name;

        if(entry[".tag"] === "folder") {
          li.classList.add("folder");
          li.onclick = () => {
            pathHistory.push(path); // ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’è¨˜éŒ²
            fetchFiles(entry.path_lower);
          };
        } else if(entry[".tag"] === "file" && entry.name.endsWith(".mp4")) {
          li.classList.add("file");
          li.onclick = () => playVideo(entry.path_lower);
        }

        list.appendChild(li);
      });
    }

    async function playVideo(path) {
      const response = await fetch(TEMP_LINK_API, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + ACCESS_TOKEN,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ path })
      });

      const data = await response.json();
      const videoUrl = data.link;

      const videoPlayer = document.getElementById("videoPlayer");
      videoPlayer.src = videoUrl;
      videoPlayer.style.display = "block";
      videoPlayer.play();
    }

    // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†
    document.getElementById("backBtn").onclick = () => {
      if (pathHistory.length > 0) {
        const prevPath = pathHistory.pop(); // ä¸€ã¤å‰ã®ãƒ‘ã‚¹ã‚’å–ã‚Šå‡ºã™
        fetchFiles(prevPath);
      }
    };

    // åˆå›å‘¼ã³å‡ºã—ï¼ˆãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€è¡¨ç¤ºï¼‰
    fetchFiles();
  </script>
</body>
</html>
